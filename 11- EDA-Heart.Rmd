---
title: "2.1-Análisis exploratorio de datos (EDA)"
author: "Jair Villanueva"
date: "4/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Análisis Exploratorio de datos (EDA)

**Definición:**

Son técnicas estadísticas cuya finalidad es conseguir un entendimiento básico de los datos y de las relaciones existentes entre las variables analizadas de un dataset. 

**Objetivos del EDA**

  * Organizar y preparar los datos
  * Detectar fallos en el diseño y recogida de los datos
  * Manejo de datos faltantes
  * Transformar/eliminar/agregar/ordenar datos
  * Identificación de casos atípicos (outliers)
  * Encontrar relaciones entre variables
  * Aplicar técnicas estadísticas para cada variable (Gráficas) 

### Introducción

Las enfermedades cardiovasculares (ECV) o enfermedades del corazón son la principal causa de muerte en todo el mundo con 17,9 millones de casos de muerte cada año . Las enfermedades cardiovasculares se deben a la hipertensión, la diabetes, el sobrepeso y los estilos de vida poco saludables. Puede leer más sobre las estadísticas de enfermedades cardíacas y las causas de la autocomprensión. Este proyecto cubre el análisis exploratorio de datos usando R. El conjunto de datos utilizado en este proyecto es el conjunto de datos de enfermedades cardíacas ("heart.csv"), y tanto los datos como el código para este proyecto están disponibles en mi repositorio de GitHub [https://github.com/jairvilla/EW3006_DataSciencexHC.git](Ew3006-DataSciencexHC).


```{r, enviroment set up warning = FALSE, message = FALSE }
# Instalar package
# if(!require(outliers)) install.packages("outliers") # Para instalar packages 

# Librerías
lib <- c("dplyr","tidyverse","ggplot2","readr", "outliers")   # Incluir las lib que se requieran
lapply(lib, require, character.only = TRUE)

# Otra forma
library(dplyr); library(outliers)

```


### Cargar el dataset: *"heart.csv"*

```{r heart}
heart <-read.csv("data/heart.csv", sep = ";", header = TRUE )
glimpse(heart)   # Resumir los datos
summary(heart)
```

Teniendo en cuenta el tipo de variables del dataset, se observa que algunas varibles son tipo categoricas (*sex*, *ca*,*diag*) y otros son numéricas(*age*,*chol*,*...*).
Sin embargo, el análisis previo muestra todas las variables como númericas.

#### Manipulación de las variables

```{r}
# Identificar datos faltantes
sum(is.na(heart))      # Contar total de NAs del dataset
colSums(is.na(heart))  # Calcular el total de NA de cada variable 
is.na(heart$age)      # Identificar los NA en una columna específica

```

### Identificación de *"outliers"*:

La variable trestbps(presión arterial) tiene un valor máx de 2000, 
lo cual es atípico. Por esta razón debemos, reemplazar los outliers 
por la media o por un valor más racional.

```{r heart }
library(outliers)        # librería 
summary(heart)           # Resumen de los datos
outlier(heart$trestbps)  # Identificar posibles valores atípicos de cada variable.
outlier(heart$thalach)   
outlier(heart$thal)
```

**Preguntas:**
  * 1. ¿Cuáles variables del dataset presentan outliers?  
  * 2. ¿Cuántos valores faltantes hay en el conjunto de datos *heart*?
  * 3. ¿En qué variables se concentran los valores faltantes?
  * 4. ¿Cómo imputaría la media o la mediana de estos valores?


### Identificar Outliers usando boxplot: 

```{r}
# variable trestbps
outlier_v1 <- boxplot(heart$trestbps, col="skyblue", frame.plot= FALSE)
outlier_v1$out

# variable Thal
outlier_v2 <- boxplot(heart$thal, col="skyblue", frame.plot= FALSE)
outlier_v2$out   # Cuantos

# Entonces para eliminar los outliers usamos el operador pertenece %in% que funciona igual que el símbolo matemático ∈ que se usa en la teoría de conjuntos.
heart <-heart[!(heart$trestbps %in% outlier_var$out),]  # Eliminar los outliers
```

### Manejo de Outliers: 

```{r}
# variable thalach  
# La variable *thalach* tiene un valor atípico de 1710 y 22:
heart$thalach <- ifelse(heart$thalach >= 250 | heart$thalach < 30,
                        mean(heart$thalach),heart$thalach)

# variable thal: 3: normal, 6 fixed detect, 7:reversable defect  

heart$thal <- factor(heart$thal)
str(heart$thal)
heart$thal <- ifelse(heart$thal <= -700,
                        mode(heart$thal),heart$thal)

```





```{r}
# Imputación de mean en NAs 
heart$age[is.na(heart$age)]<- round(mean(heart$age, na.rm = TRUE))
heart$chol[is.na(heart$chol)]<- round (mean(heart$chol, na.rm = TRUE))
heart$trestbps[is.na(heart$chol)]<- round (mean(heart$chol, na.rm = TRUE))
heart$chol[is.na(heart$chol)]<- round (mean(heart$chol, na.rm = TRUE))


heart_mod <- heart %>%
  dplyr::select(-id)%>%     # Eliminar Variable id 
  
```




**Avanzado:** Creando un ciclo for

```{r}
for(i in 1:ncol(heart)){
  heart[is.na(heart[,i]), i] <- mean(heart[,i], na.rm = TRUE)
    }
summary(heart)

```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
